package classes.Items.Transformatives
{
	import classes.ItemSlotClass;
	import classes.Creature;
	import classes.kGAMECLASS;
	import classes.Characters.PlayerCharacter;
	import classes.GameData.TooltipManager;
	import classes.StringUtil;
	import classes.GLOBAL;
	import classes.Util.*;
	import classes.Engine.Interfaces.*;
	import classes.Engine.Utility.*;

	/**
	Changes areola shapes
	 */
	public class Areolove extends ItemSlotClass
	{
		private var counter:int = 0;
		private var options:Array = [];
		
		public function Areolove()
		{
			this._latestVersion = 1;
			
			this.quantity = 1;
			this.stackSize = 10;
			this.type = GLOBAL.PILL;
			//Used on inventory buttons
			this.shortName = "Areolove";
			//Regular name
			this.longName = "dose of Areolove";
			
			TooltipManager.addFullName(this.shortName, StringUtil.toTitleCase(this.longName));
			
			//Longass shit, not sure what used for yet.
			this.description = "a medipen loaded with Areolove";
			//Displayed on tooltips during mouseovers
			this.tooltip = "A low-grade transformative, Areolove will change the shape of the user's areolae. Buttons with various shape line up across the length of the medipen, featuring many ways to stylize your nipples. There's a small disclaimer stating that this product might not work on unusual nipple types.";
			
			TooltipManager.addTooltip(this.shortName, this.tooltip);
			
			this.attackVerb = "";
			
			//Information
			this.basePrice = 750;
			this.attack = 0;
			this.defense = 0;
			this.shieldDefense = 0;
			this.shields = 0;
			this.sexiness = 0;
			this.critBonus = 0;
			this.evasion = 0;
			this.fortification = 0;
			
			this.version = this._latestVersion;
		}
		
		//METHOD ACTING!
		override public function useFunction(target:Creature, usingCreature:Creature = null):Boolean
		{
			var buttons:int = 0;
			clearOutput();
			clearMenu();
			author("Somebody Else");
			if (target is PlayerCharacter)
			{
				if (!target.hasNipples())
				{
					areoloveCancel(target);
				}
			
				else addButton(14, "Back", areoloveCancel, target);
				output("The medipen has a number of symbol shaped buttons on it.")
				
				//Puffy
				if (target.breastRows[0].hasFlag(GLOBAL.FLAG_PUMPED))
				{
					addDisabledButton(buttons++,"Puffy","Puffy","Your areolae are already puffy.");
				}
				else
				{
					addButton(buttons++, "Puffy", changeThemBoobHats, [GLOBAL.FLAG_PUMPED, target], "Puffy", "Makes your areolae puffy.");
				}
				//Depuff
				if (!target.breastRows[0].hasFlag(GLOBAL.FLAG_PUMPED))
				{
					addDisabledButton(buttons++,"Flat","Flat","Your areolae are already flat.");
				}
				else
				{
					addButton(buttons++, "Flat", changeThemBoobHats, [-1, target], "Flat", "Makes your areolae flat.");
				}
				
				//Circles
				if (!target.breastRows[0].hasFlag(GLOBAL.FLAG_HEART_SHAPED) && !target.breastRows[0].hasFlag(GLOBAL.FLAG_STAR_SHAPED))
				{
					addDisabledButton(buttons++,"Circles","Circles","Your areolae are already shaped like circles.");
				}
				else
				{
					addButton(buttons++, "Circles", changeThemBoobHats, [0, target], "Circles", "Changes the shape of your areolae to circles.");
				}
			
				//Heart shaped areola
				if (target.breastRows[0].hasFlag(GLOBAL.FLAG_HEART_SHAPED)) 
				{
					addDisabledButton(buttons++,"Hearts","Hearts","Your areolae are already shaped like hearts.");
				}
				else
				{
					addButton(buttons++, "Hearts", changeThemBoobHats, [GLOBAL.FLAG_HEART_SHAPED, target], "Hearts", "Changes the shape of your areolae to hearts.");
				}
			
				//Star shaped areola
				if (target.breastRows[0].hasFlag(GLOBAL.FLAG_STAR_SHAPED))
				{
					addDisabledButton(buttons++,"Stars","Stars","Your areolae are already shaped like stars.");
				}
				else
				{
					addButton(buttons++, "Stars", changeThemBoobHats, [GLOBAL.FLAG_STAR_SHAPED, target], "Stars", "Changes the shape of your areolae to stars.");
				}
			
			return true;
			}
			
			//Not player!
			else
			{
				output(target.capitalA + target.short + " injects the Areolove to no effect.");
			}
			return false;
		}
		
		private function changeThemBoobHats(arg:Array):void
		{
			var selection:int = arg[0];			
			var target:Creature = arg[1];
			var i:int;
			var clothed:Boolean = true;
			author("Somebody Else");
			
			//Nipple flags locked: no changes
			if (!target.nippleFlagUnlocked(0, 0))
			{
				output("You feel a brief tingling in your areolae, but nothing else happens. What a waste.");
				clearMenu(); 
				addButton(0, "Next", mainGameMenu);
				return;
			}
			
			//Selection independent stuff
			//Some Steeles are shy/unable to strip
			if (target.isChestGarbed() && kGAMECLASS.rooms[kGAMECLASS.currentLocation].hasFlag(GLOBAL.PUBLIC) && target.exhibitionism() <= 66 || target.isChestGarbed && kGAMECLASS.rooms[kGAMECLASS.currentLocation].hasFlag(GLOBAL.NUDITY_ILLEGAL)) output("You peek down your top to get a look at the changes as they unfold.");
			else 
			{
				clothed = false;
				output("You " + (target.isChestGarbed() ? "strip out of your gear":"look down") + " to watch the changes as they progress.");
			}
			output(" A slight pins and needles sensation buds in your areolae, then it rapidly builds to the point where you let out a small gasp at the intensity. As the feeling reaches its peak, each individual pinprick takes on a laser-like feeling of heat, there and gone almost too quickly to notice were it not for the staggering number of them. Your breath occasionally hitching in your throat, you watch as the transformation begins.");
			
			//Selection dependent stuff
			switch (selection)
			{
				//Puff
				case GLOBAL.FLAG_PUMPED:
					output(" The sensations diffuse evenly throughout your areolae, increasing the amount of tissue to reach your desired shape. <b>Your areolae are now puffy!</b>");
					for(i = 0; i < target.breastRows.length; i++)
					{
						target.breastRows[i].addFlag(GLOBAL.FLAG_PUMPED); 
					}
					break;
				//Unpuff
				case -1:
					output(" The sensations diffuse evenly throughout your areolae, increasing the amount of tissue to reach your desired shape.<b>Your areolae are no longer puffy.</b>");
					for(i = 0; i < target.breastRows.length; i++)
					{
						target.breastRows[i].delFlag(GLOBAL.FLAG_PUMPED); 
					}
					break;
				//Circles
				case 0:
					output(" The sensations focus themselves around the edges of your areolae, reshaping the outline into a much more exciting shape. <b>Your areolae are now circles!</b>");
					for(i = 0; i < target.breastRows.length; i++)
					{
						target.breastRows[i].delAreolaShapeFlags(); 
					}
					break;
				//Hearts
				case GLOBAL.NIPPLE_FLAG_HEART_AREOLA:
					output(" The sensations focus themselves around the edges of your areolae, reshaping the outline into a much more exciting shape. <b>Your areolae are now hearts!</b>");
					for(i = 0; i < target.breastRows.length; i++)
					{
						target.breastRows[i].delAreolaShapeFlags();
						target.breastRows[i].addFlag(GLOBAL.FLAG_HEART_SHAPED);
					}
					break;
				//Stars
				case GLOBAL.NIPPLE_FLAG_STAR_AREOLA:
					output(" The sensations focus themselves around the edges of your areolae, reshaping the outline into a much more exciting shape. <b>Your areolae are now stars!</b>");
					for(i = 0; i < target.breastRows.length; i++)
					{
						target.breastRows[i].delAreolaShapeFlags();
						target.breastRows[i].addFlag(GLOBAL.FLAG_STAR_SHAPED);
					}
					break;
			}
			
			//Puts gear back on if it was taken off earlier
			if(target.isChestGarbed() && clothed == false) output(" Shivering a bit from the lingering sensations, you put your gear back on.");
			target.lust(10);
			kGAMECLASS.processTime(5);
			clearMenu(); 
			addButton(0, "Next", mainGameMenu);
		}
		
		private function areoloveCancel(target:Creature):void
		{
			clearOutput();
			author("Somebody Else");
			
			if (!target.hasNipples()) output("You need nipples to use this item.\n\n");
			output("You put the Areolove back into your inventory.\n\n");
			if (!kGAMECLASS.infiniteItems()) kGAMECLASS.itemCollect([new Areolove()]);
			else
			{
				clearMenu();
				addButton(0,"Next",kGAMECLASS.useItemFunction);
			}
		}		
	}
}
